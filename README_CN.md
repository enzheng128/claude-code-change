# Claude Code Change

一个为 Claude Code 对话提供文件比较和变更跟踪功能的 VSCode 扩展。

## 功能特性

- **活动栏集成**：在 VSCode 活动栏添加双箭头图标 (↔) 按钮，便于快速访问
- **文件树浏览器**：在专用的变更目录中浏览文件，支持文件夹结构
- **差异比较**：点击任何文件打开差异视图，比较工作区文件与缓存的变更
- **变更统计**：一目了然地查看每个文件的增加/删除行数
- **自动刷新**：文件和差异统计每5秒自动刷新
- **手动刷新**：使用刷新按钮立即更新
- **工具安装**：通过命令面板安装配套工具

## 安装

1. 从 VSCode 市场安装扩展
2. 打开命令面板（`Cmd+Shift+P` / `Ctrl+Shift+P`）
3. 运行 "Claude Code Change: Install Tools"
4. 扩展将：
   - 在 `~/.claudeCodeChange/tools/` 中设置必要的工具
   - 向 Claude Code 的 settings.json 文件注入钩子以实现自动文件跟踪

**⚠️ 重要提示**：安装过程将修改您的 Claude Code settings.json 文件以添加钩子配置。**请勿手动删除这些钩子条目**，因为它们对扩展的正常工作至关重要。

## 使用方法

### 查看变更

1. 点击活动栏中的双箭头 (↔) 按钮
2. 在 Claude Code Change 面板中浏览文件
3. 点击任何文件打开差异视图：
   - 左侧：缓存的变更
   - 右侧：当前工作区文件
4. 悬停在文件上查看工作区文件路径

### 变更统计

每个文件显示格式如下的变更统计：
- `(+5 -2)` - 增加5行，删除2行
- `(+10)` - 增加10行（新文件）
- `(-3)` - 删除3行

### 目录结构

文件在扩展的缓存目录中组织：
```
~/.claudeCodeChange/
├── change_{工作区_md5}/
│   ├── src/
│   │   ├── file1.ts
│   │   └── file2.ts
│   └── docs/
│       └── readme.md
└── tools/
    ├── claudeChangePreToolUse.js
    └── claudeChangeStop.js
```

## 配置

扩展自动：
- 基于工作区 MD5 哈希创建缓存目录
- 维护与项目匹配的文件夹结构
- 提供实时差异统计
- 向 Claude Code 设置注入钩子以进行文件跟踪

### Claude Code 集成

安装后，扩展会向位于以下位置的 Claude Code settings.json 文件添加钩子：
- **macOS**: `~/.claude/settings.json`
- **Windows**: `%USERPROFILE%\.claude\settings.json`
- **Linux**: `~/.claude/settings.json`

这些钩子使 Claude Code 在处理文件操作时能够自动缓存文件。钩子包括：
- 用于文件缓存的工具使用前钩子
- 用于会话管理的停止钩子

**重要提示**：请勿手动删除这些钩子配置，因为它们是正常功能所必需的。

## 技术细节

- **工作区检测**：使用工作区路径的 MD5 哈希进行唯一标识
- **文件扫描**：递归扫描缓存目录，具有适当的 TypeScript 类型
- **差异算法**：基于行的比较，显示增加和删除
- **自动刷新**：5秒间隔更新以进行实时跟踪

## 命令

- `Claude Code Change: Install Tools` - 安装配套工具
- `Refresh` - 手动刷新文件树和差异统计

## 要求

- VSCode 1.74.0 或更高版本
- Node.js 用于工具编译（仅开发时需要）

## 扩展设置

此扩展贡献以下设置：

- 自动文件扫描和差异计算
- 带双箭头图标的活动栏集成
- 支持文件/文件夹结构的树视图

## 已知问题

- 大文件可能需要更长时间计算差异统计
- 不支持二进制文件的差异比较

## 发布说明

### 1.0.0

初始版本，包含核心功能：
- 带差异比较的文件树浏览器
- 变更统计显示
- 工具安装系统
- 自动刷新功能

## 贡献

此扩展专为 Claude Code 对话和变更跟踪工作流程设计。

## 许可证

ISC 许可证